(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"0927cb33fb85ce8bf5d3":function(e,t,n){(t=e.exports=n("c138e55a31f3f8960e99")(!1)).push([e.i,"._2iVyVG5waRR0nxgBxXBTEs{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}._1jsXIRCS5A1hdWfBKkqwDG{overflow:-moz-scrollbars-none !important;-ms-overflow-style:none !important}._1jsXIRCS5A1hdWfBKkqwDG::-webkit-scrollbar{display:none}.uc58VLkUPAa4QHX5E1YfL{width:320px;background-color:rgba(34,49,81,0.5);padding-top:64px;margin-bottom:180px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;z-index:1}.uc58VLkUPAa4QHX5E1YfL ._2p9cXjtfcKyHCQ6a_lJiQW{width:100%;margin-bottom:32px}.uc58VLkUPAa4QHX5E1YfL button{width:75%;height:36px;background-color:transparent;border:1px solid #fff;border-radius:3px;color:#fff;font-size:1.15em;outline:none}.uc58VLkUPAa4QHX5E1YfL button[disabled]{background-color:rgba(255,255,255,0.2)}.uc58VLkUPAa4QHX5E1YfL button i{margin-right:8px}._3fCS1j5LMaW9HtYVl6ipPm{height:45px;border-bottom:1px solid #fff;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}._3fCS1j5LMaW9HtYVl6ipPm:last-child{border-bottom:0}._3fCS1j5LMaW9HtYVl6ipPm i{color:#fff;font-size:24px;-ms-flex-negative:0;flex-shrink:0}._3fCS1j5LMaW9HtYVl6ipPm input{-webkit-box-flex:1;-ms-flex:1;flex:1;background-color:transparent;padding:0 8px;border:0;outline:none;color:#fff;font-size:1.15em}._3fCS1j5LMaW9HtYVl6ipPm input::-webkit-input-placeholder{color:rgba(255,255,255,0.75)}._3fCS1j5LMaW9HtYVl6ipPm input::-moz-placeholder{color:rgba(255,255,255,0.75)}._3fCS1j5LMaW9HtYVl6ipPm input:-ms-input-placeholder{color:rgba(255,255,255,0.75)}._3fCS1j5LMaW9HtYVl6ipPm input:-moz-placeholder{color:rgba(255,255,255,0.75)}._3fCS1j5LMaW9HtYVl6ipPm input:-webkit-autofill{-webkit-text-fill-color:#fff;-webkit-transition:background-color 9999s ease-in-out 0s;transition:background-color 9999s ease-in-out 0s}._1PwP8YzfxL769AEzyWD3yf{margin-top:16px}._1PwP8YzfxL769AEzyWD3yf span{color:#f7f7f7}._1PwP8YzfxL769AEzyWD3yf a{font-weight:600}.QnEOLntS-Rfuvdztr7hNo{padding:20px 0;color:#fff}",""]),t.locals={ellipsis:"_2iVyVG5waRR0nxgBxXBTEs",hideScrollbar:"_1jsXIRCS5A1hdWfBKkqwDG",window:"uc58VLkUPAa4QHX5E1YfL",form:"_2p9cXjtfcKyHCQ6a_lJiQW",input:"_3fCS1j5LMaW9HtYVl6ipPm",tips:"_1PwP8YzfxL769AEzyWD3yf",joinOrganizationLoadingContent:"QnEOLntS-Rfuvdztr7hNo"}},2:function(e,t,n){n("5b15df55c1316f23e9d0"),e.exports=n("baf7021f8a6fabdc859e")},"788b454b5eadc7b7f231":function(e,t,n){var r=n("0927cb33fb85ce8bf5d3");"string"===typeof r&&(r=[[e.i,r,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n("1e4534d1d62a11482e97")(r,a);r.locals&&(e.exports=r.locals)},baf7021f8a6fabdc859e:function(e,t,n){"use strict";n.r(t);n("8c8e4f08a118a28666b0");var r=n("8af190b70a6bc55c6f1b"),a=n.n(r),o=n("235ef2b9b87705660668"),i=n("d7dd51e1bf6bfc2c9c3d"),c=n("657e23e47d6bc2372772"),l=n("3ad3c1378076e862aab0"),s=n("3e48a4ad164080264b3b"),u=n("0d7f0986bcd2f33d8a2a"),d=n.n(u),f=n("ab4cb61bcb2dc161defb"),p=n("811a4999285c4f950f0a"),b=n("fe25efaa8d6f45e3f5f9"),g="davinci/App/LOGIN",m="davinci/App/LOGGED",y="davinci/App/LOGOUT",h=n("54f683fcda7806277002"),v=Object(h.fromJS)({logged:!1,loginUser:null});var O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case m:return e.set("logged",!0).set("loginUser",r.user);case y:return e.set("logged",!1).set("loginUser",null);default:return e}},S=n("74431d47afb6248fcb69"),w=n("6c68d13fe9e3e77d8fc4");var I=n("95066b9b78a83cfbe91a"),L=n("55c69f0ea731e712b8f3"),j=n("9adba983ceae6f089ff0"),A=regeneratorRuntime.mark(E),D=regeneratorRuntime.mark(_);function E(e){var t,n,r,a,o,i;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.payload,n=t.username,r=t.password,a=t.shareInfo,o=t.resolve,c.prev=1,c.next=4,Object(w.b)(I.a,{method:"post",url:"".concat(j.a.share,"/login/").concat(a),data:{username:n,password:r}});case 4:return i=c.sent,c.next=7,Object(w.c)((l=i.payload,{type:m,payload:{user:l}}));case 7:o(),c.next=13;break;case 10:c.prev=10,c.t0=c.catch(1),Object(L.a)(c.t0);case 13:case"end":return c.stop()}var l},A,null,[[1,10]])}function _(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[Object(S.c)(g,E)];case 2:case"end":return e.stop()}},D)}var k=Object(p.a)({key:"global",reducer:O}),C=Object(b.a)({key:"global",saga:_}),T=Object(f.compose)(k,C)(function(e){return r.createElement("div",null,r.createElement(d.a,{titleTemplate:"%s - Visualis",defaultTitle:"Visualis Web Application",meta:[{name:"description",content:"Visualis web application built for data visualization"}]}),r.Children.toArray(e.children))}),x=n("3c6f77ec51e7bc1a2a2a"),P=n("8f1ab66ca98a22c9179d"),R=(n("1fa8f1fa59fdd9f24c28"),n("4ce54d943eb1f3decabb"),n("4e2e9348dad8fe460c1d")),F=n("64609e458c41f180e307");function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H=Object(h.fromJS)({locationBeforeTransitions:null});function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.LOCATION_CHANGE:return e.merge({locationBeforeTransitions:t.payload});default:return e}}function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(R.combineReducers)(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){V(e,t,n[t])})}return e}({route:q,language:F.a},e))}var U=Object(S.a)();var W=n("ed636e9c6a0f78dd7081"),z=(n("430efd9ee93fab5ea3aa"),n("ab77426700a64afb515f")),Y=n.n(z),M=(n("cce4e96b47a88eedc219"),n("4634762afad890a7174e")),B=n.n(M),G=(n("aaa12c37f93504858944"),n("21677e23133eca295df8")),K=n.n(G),Q=n("a28fc3c963a1d4d1a2e5"),J="davinci/Share/LOAD_SHARE_DASHBOARD",X="davinci/Share/LOAD_SHARE_DASHBOARD_SUCCESS",Z="davinci/Share/LOAD_SHARE_DASHBOARD_FAILURE",$="davinci/Share/SET_INDIVIDUAL_DASHBOARD",ee="davinci/Share/LOAD_SHARE_WIDGET",te="davinci/Share/LOAD_SHARE_WIDGET_SUCCESS",ne="davinci/Share/LOAD_SHARE_RESULTSET",re="davinci/Share/LOAD_SHARE_RESULTSET_SUCCESS",ae="davinci/Share/LOAD_SHARE_RESULTSET_FAILURE",oe="davinci/Share/LOAD_WIDGET_CSV",ie="davinci/Share/LOAD_WIDGET_CSV_SUCCESS",ce="davinci/Share/LOAD_WIDGET_CSV_FAILURE",le="davinci/Share/LOAD_SELECT_OPTIONS",se="davinci/Share/LOAD_SELECT_OPTIONS_SUCCESS",ue="davinci/Share/LOAD_SELECT_OPTIONS_FAILURE",de="davinci/Share/RESIZE_ALL_DASHBOARDITEM",fe="davinci/Share/DRILL_DASHBOARDITEM",pe="davinci/Share/DELETE_DRILL_HISTORY",be="davinci/Share/SET_SELECT_OPTIONS",ge="davinci/Share/SELECT_DASHBOARD_ITEM_CHART",me="davinci/Share/GLOBAL_CONTROL_CHANGE",ye="davinci/Share/SEND_SHARE_PARAMS",he="davinci/Share/LOAD_DOWNLOAD_LIST",ve="davinci/Share/LOAD_DOWNLOAD_LIST_SUCCESS",Oe="davinci/Share/LOAD_DOWNLOAD_LIST_FAILURE",Se="davinci/Share/DOWNLOAD_FILE",we="davinci/Share/DOWNLOAD_FILE_SUCCESS",Ie="davinci/Share/DOWNLOAD_FILE_FAILURE",Le="davinci/Share/INITIATE_DOWNLOAD_TASK",je="davinci/Share/INITIATE_DOWNLOAD_TASK_SUCCESS",Ae="davinci/Share/INITIATE_DOWNLOAD_TASK_FAILURE",De=n("e8016aecc1958cdf3c4a"),Ee=n("11a323f8e5936c04fbd3"),_e=n("178f6adcf35ca45776ac"),ke=n("9d7a9f8e28ee3216e3c6"),Ce=n("f6c48cace3512f9906d5");function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){xe(e,t,n[t])})}return e}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Re=Object(h.fromJS)({dashboard:null,title:"",config:"{}",dashboardSelectOptions:null,widgets:null,items:null,itemsInfo:null,downloadListLoading:!1,downloadList:null,downloadListInfo:null,shareParams:null});var Fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Re,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload,a=e.get("dashboardSelectOptions"),o=e.get("itemsInfo"),i=e.get("widgets"),c=e.get("downloadList"),l=e.get("shareParams");switch(n){case ye:return e.set("shareParams",r.params);case X:var s=r.dashboard.config?JSON.parse(r.dashboard.config):{},u=(s.filters||[]).map(function(e){return Object(_e.b)(e)}).map(function(e){var t=e.relatedViews,n=e.name;return l&&Object.entries(t).forEach(function(t){var r=Pe(t,2),a=(r[0],r[1],l[n]);a&&a.length&&(e&&"date"===e.type&&(e.dynamicDefaultValue=De.a.Custom),e.defaultValue=Array.isArray(a)&&a.length?a.map(function(e){return decodeURI(e)}):decodeURI(a))}),e}),d={};return u.forEach(function(e){var t=e.interactionType,n=e.relatedItems,r=e.relatedViews,a=Object(Ee.a)(e);a&&Object.entries(n).forEach(function(n){var o=Pe(n,2),i=o[0],c=o[1];Object.entries(r).forEach(function(n){var r=Pe(n,2),o=r[0],l=r[1];if(c.checked&&c.viewId===Number(o)){var s="column"===t?Object(Ee.h)(e,l,a):Object(Ee.m)(e,l,a);d[i]||(d[i]={filters:[],variables:[]}),"column"===t?d[i].filters=d[i].filters.concat(s):d[i].variables=d[i].variables.concat(s)}})})}),e.set("title",r.dashboard.name).set("dashboard",Te({},r.dashboard,{config:JSON.stringify(Te({},s,{filters:u}))})).set("config",JSON.stringify(Te({},s,{filters:u}))).set("dashboardSelectOptions",{}).set("widgets",r.dashboard.widgets).set("items",r.dashboard.relations).set("itemsInfo",r.dashboard.relations.reduce(function(e,t){return e[t.id]={status:fn.Initial,datasource:{resultList:[]},loading:!0,queryConditions:{tempFilters:[],linkageFilters:[],globalFilters:d[t.id]?d[t.id].filters:[],variables:[],linkageVariables:[],globalVariables:d[t.id]?d[t.id].variables:[],pagination:{}},downloadCsvLoading:!1,interactId:"",renderType:"rerender",controlSelectOptions:{},errorMessage:""},e},{}));case $:return e.set("items",[{id:1,x:0,y:0,width:12,height:12,polling:!1,frequency:0,widgetId:r.widgetId,dataToken:r.token}]).set("itemsInfo",{1:{status:fn.Initial,datasource:{resultList:[]},loading:!1,queryConditions:{tempFilters:[],linkageFilters:[],globalFilters:[],variables:[],linkageVariables:[],globalVariables:[],pagination:{}},downloadCsvLoading:!1,interactId:"",renderType:"rerender",controlSelectOptions:{},errorMessage:""}});case te:return i||(i=[]),e.set("widgets",i.concat(r.widget));case ge:return e.set("itemsInfo",Te({},o,xe({},r.itemId,Te({},o[r.itemId],{renderType:r.renderType,selectedItems:r.selectedItems}))));case ne:return e.set("itemsInfo",Te({},o,xe({},r.itemId,Te({},o[r.itemId],{selectedItems:[],loading:!0,errorMessage:"",queryConditions:Te({},o[r.itemId].queryConditions,{tempFilters:r.requestParams.tempFilters,linkageFilters:r.requestParams.linkageFilters,globalFilters:r.requestParams.globalFilters,variables:r.requestParams.variables,linkageVariables:r.requestParams.linkageVariables,globalVariables:r.requestParams.globalVariables,pagination:r.requestParams.pagination,nativeQuery:r.requestParams.nativeQuery})}))));case me:var f=r.controlRequestParamsByItem;return Object.entries(f).forEach(function(e){var t=Pe(e,2),n=t[0],r=t[1],a=r.filters,i=r.variables;o[n].queryConditions=Te({},o[n].queryConditions,{},a&&{globalFilters:a},{},i&&{globalVariables:i})}),e.set("itemsInfo",o);case fe:return o[r.itemId].queryConditions.drillHistory||(o[r.itemId].queryConditions.drillHistory=[]),e.set("itemsInfo",Te({},o,xe({},r.itemId,Te({},o[r.itemId],{queryConditions:Te({},o[r.itemId].queryConditions,{drillHistory:o[r.itemId].queryConditions.drillHistory.concat(r.drillHistory)})}))));case pe:return e.set("itemsInfo",Te({},o,xe({},r.itemId,Te({},o[r.itemId],{queryConditions:Te({},o[r.itemId].queryConditions,{drillHistory:o[r.itemId].queryConditions.drillHistory.slice(0,r.index+1)})}))));case re:return Object(Ce.c)(r.resultset.resultList,r.requestParams.customOrders),e.set("itemsInfo",Te({},o,xe({},r.itemId,Te({},o[r.itemId],{status:fn.Fulfilled,loading:!1,datasource:r.resultset||{resultList:[]},renderType:r.renderType}))));case ae:return e.set("itemsInfo",Te({},o,xe({},r.itemId,Te({},o[r.itemId],{status:fn.Error,loading:!1,errorMessage:r.errorMessage}))));case oe:return e.set("itemsInfo",Te({},o,xe({},r.itemId,Te({},o[r.itemId],{downloadCsvLoading:!0}))));case ie:case ce:return e.set("itemsInfo",Te({},o,xe({},r.itemId,Te({},o[r.itemId],{downloadCsvLoading:!1}))));case se:return r.itemId?e.set("itemsInfo",Te({},o,xe({},r.itemId,Te({},o[r.itemId],{controlSelectOptions:Te({},o[r.itemId].controlSelectOptions,xe({},r.controlKey,r.values))})))):e.set("dashboardSelectOptions",Te({},a,xe({},r.controlKey,r.values)));case be:return r.itemId?e.set("itemsInfo",Te({},o,xe({},r.itemId,Te({},o[r.itemId],{controlSelectOptions:Te({},o[r.itemId].controlSelectOptions,xe({},r.controlKey,r.options))})))):e.set("dashboardSelectOptions",Te({},a,xe({},r.controlKey,r.options)));case de:return e.set("itemsInfo",Object.entries(o).reduce(function(e,t){var n=Pe(t,2),r=n[0],a=n[1];return e[r]=Te({},a,{renderType:"resize",datasource:Te({},a.datasource)}),e},{}));case he:return e.set("downloadListLoading",!0);case ve:return e.set("downloadListLoading",!1).set("downloadList",r.list).set("downloadListInfo",r.list.reduce(function(e,t){return e[t.id]={loading:!1},e},{}));case Oe:return e.set("downloadListLoading",!1);case we:return e.set("downloadList",c.map(function(e){return e.id===r.id?Te({},e,{status:ke.a.Downloaded}):e}));default:return e}},Ve=n("4633b5891e83a9df58b7"),He=n.n(Ve);function qe(e){return{type:X,payload:{dashboard:e}}}function Ne(e){return{type:te,payload:{widget:e}}}function Ue(e,t,n,r){return{type:re,payload:{renderType:e,itemId:t,requestParams:n,resultset:r}}}function We(e,t){return{type:ae,payload:{itemId:e,errorMessage:t}}}function ze(e){return{type:ie,payload:{itemId:e}}}function Ye(e){return{type:ce,payload:{itemId:e}}}function Me(e,t,n){return{type:se,payload:{controlKey:e,values:t,itemId:n}}}function Be(e){return{type:we,payload:{id:e}}}function Ge(e,t){return{type:je,payload:{type:e,itemId:t}}}var Ke=n("eb331aa378875c02c40d");function Qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Xe(e,t,n[t])})}return e}function Xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ze(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var $e=regeneratorRuntime.mark(lt),et=regeneratorRuntime.mark(st),tt=regeneratorRuntime.mark(ut),nt=regeneratorRuntime.mark(dt),rt=regeneratorRuntime.mark(ft),at=regeneratorRuntime.mark(pt),ot=regeneratorRuntime.mark(bt),it=regeneratorRuntime.mark(gt),ct=regeneratorRuntime.mark(mt);Ke.a[Ke.b].shareHost;function lt(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.payload,r.prev=1,r.next=4,Object(w.b)(I.a,"".concat(j.a.share,"/dashboard/").concat(t.token));case 4:return n=r.sent,r.next=7,Object(w.c)(qe(n.payload));case 7:r.next=15;break;case 9:return r.prev=9,r.t0=r.catch(1),r.next=13,Object(w.c)({type:Z});case 13:Object(L.a)(r.t0),t.reject(r.t0);case 15:case"end":return r.stop()}},$e,null,[[1,9]])}function st(e){var t,n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e.payload,r.prev=1,r.next=4,Object(w.b)(I.a,"".concat(j.a.share,"/widget/").concat(t.token));case 4:return n=r.sent,r.next=7,Object(w.c)(Ne(n.payload));case 7:t.resolve&&t.resolve(n.payload),r.next=14;break;case 10:r.prev=10,r.t0=r.catch(1),Object(L.a)(r.t0),t.reject(r.t0);case 14:case"end":return r.stop()}},et,null,[[1,10]])}function ut(e){var t,n,r,a,o,i,c,l,s,u,d,f,p,b,g,m,y,h,v;return regeneratorRuntime.wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return t=e.payload,n=t.renderType,r=t.itemId,a=t.dataToken,o=t.requestParams,i=o.filters,c=o.tempFilters,l=o.linkageFilters,s=o.globalFilters,u=o.variables,d=o.linkageVariables,f=o.globalVariables,p=o.pagination,b=Ze(o,["filters","tempFilters","linkageFilters","globalFilters","variables","linkageVariables","globalVariables","pagination"]),m=(g=p||{pageSize:0,pageNo:0}).pageSize,y=g.pageNo,O.prev=4,O.next=7,Object(w.b)(I.a,{method:"post",url:"".concat(j.a.share,"/data/").concat(a),data:Je({},He()(b,"customOrders"),{filters:i.concat(c).concat(l).concat(s),params:u.concat(d).concat(f),pageSize:m,pageNo:y})});case 7:return h=O.sent,v=h.payload.resultList,h.payload.resultList=v&&v.slice(0,600)||[],O.next=12,Object(w.c)(Ue(n,r,o,h.payload));case 12:O.next=18;break;case 14:return O.prev=14,O.t0=O.catch(4),O.next=18,Object(w.c)(We(r,Object(L.b)(O.t0)));case 18:case"end":return O.stop()}},tt,null,[[4,14]])}function dt(e){var t,n,r,a,o,i,c,l,s,u,d,f,p;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return t=e.payload,n=t.itemId,r=t.requestParams,a=t.token,o=r.filters,i=r.tempFilters,c=r.linkageFilters,l=r.globalFilters,s=r.variables,u=r.linkageVariables,d=r.globalVariables,f=Ze(r,["filters","tempFilters","linkageFilters","globalFilters","variables","linkageVariables","globalVariables"]),b.prev=2,b.next=5,Object(w.b)(I.a,{method:"post",url:"".concat(j.a.share,"/csv/").concat(a),data:Je({},f,{filters:o.concat(i).concat(c).concat(l),params:s.concat(u).concat(d)})});case 5:return p=b.sent,b.next=8,Object(w.c)(ze(n));case 8:location.href=p.payload,b.next=16;break;case 11:return b.prev=11,b.t0=b.catch(2),b.next=15,Object(w.c)(Ye(n));case 15:Object(L.a)(b.t0);case 16:case"end":return b.stop()}},nt,null,[[2,11]])}function ft(e){var t,n,r,a,o,i,c,l,s;return regeneratorRuntime.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.prev=0,t=e.payload,n=t.controlKey,r=t.dataToken,a=t.requestParams,o=t.itemId,i=Object.entries(a),c=i.map(function(e){var t=Qe(e,2),n=t[0],a=t[1],o=a.columns,i=a.filters,c=a.variables,l=a.cache,s=a.expired;return Object(w.b)(I.a,{method:"post",url:"".concat(j.a.share,"/data/").concat(r,"/distinctvalue/").concat(n),data:{columns:o,filters:i,params:c,cache:l,expired:s}})}),u.next=7,Object(w.a)(c);case 7:return l=u.sent,s=l.reduce(function(e,t,n){var r=i[n][1].columns;return 1===r.length?e.concat(t.payload.map(function(e){return e[r[0]]})):e},[]),u.next=11,Object(w.c)(Me(n,Array.from(new Set(s)),o));case 11:u.next=17;break;case 13:return u.prev=13,u.t0=u.catch(0),u.next=17,Object(w.c)((d=u.t0,{type:ue,payload:{error:d}}));case 17:case"end":return u.stop()}var d},rt,null,[[0,13]])}function pt(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,n=t.shareClinetId,r=t.token,o.prev=1,o.next=4,Object(w.b)(I.a,"".concat(j.a.download,"/share/page/").concat(n,"/").concat(r));case 4:return a=o.sent,o.next=7,Object(w.c)((c=a.payload,{type:ve,payload:{list:c}}));case 7:o.next=14;break;case 9:return o.prev=9,o.t0=o.catch(1),o.next=13,Object(w.c)((i=o.t0,{type:Oe,payload:{error:i}}));case 13:Object(L.a)(o.t0);case 14:case"end":return o.stop()}var i,c},at,null,[[1,9]])}function bt(e){var t,n,r,a;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.payload,n=t.id,r=t.shareClinetId,a=t.token,o.prev=1,location.href="".concat(j.a.download,"/share/record/file/").concat(n,"/").concat(r,"/").concat(a),o.next=5,Object(w.c)(Be(n));case 5:o.next=12;break;case 7:return o.prev=7,o.t0=o.catch(1),o.next=11,Object(w.c)((i=o.t0,{type:Ie,payload:{error:i}}));case 11:Object(L.a)(o.t0);case 12:case"end":return o.stop()}var i},ot,null,[[1,7]])}function gt(e){var t,n,r,a,o,i;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return t=e.payload,n=t.shareClientId,r=t.dataToken,a=t.type,o=t.itemId,c.prev=1,i=e.payload.downloadParams.map(function(e){var t=e.id,n=e.filters,r=e.tempFilters,a=e.linkageFilters,o=e.globalFilters,i=e.variables,c=e.linkageVariables,l=e.globalVariables;return{id:t,param:Je({},Ze(e,["id","filters","tempFilters","linkageFilters","globalFilters","variables","linkageVariables","globalVariables"]),{filters:n.concat(r).concat(a).concat(o),params:i.concat(c).concat(l)})}}),c.next=5,Object(w.b)(I.a,{method:"POST",url:"".concat(j.a.download,"/share/submit/").concat(a,"/").concat(n,"/").concat(r),data:i});case 5:return K.a.success("\u4e0b\u8f7d\u4efb\u52a1\u521b\u5efa\u6210\u529f\uff01"),c.next=8,Object(w.c)(Ge(a,o));case 8:c.next=15;break;case 10:return c.prev=10,c.t0=c.catch(1),c.next=14,Object(w.c)((l=c.t0,{type:Ae,payload:{error:l}}));case 14:Object(L.a)(c.t0);case 15:case"end":return c.stop()}var l},it,null,[[1,10]])}function mt(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[Object(S.c)(J,lt),Object(S.b)(ee,st),Object(S.b)(ne,ut),Object(S.c)(oe,dt),Object(S.b)(le,ft),Object(S.c)(he,pt),Object(S.c)(Se,bt),Object(S.b)(Le,gt)];case 2:case"end":return e.stop()}},ct)}var yt=n("6c1890243ba884c62600"),ht=n("38669f46145e5bedaa8f"),vt=n("cd16e7d68404f3230c38"),Ot=n("86d17dd26e83afa66ef9"),St=n("d13558d97f410e04ee44"),wt=n("588010b67050044e2341"),It=n("30cc03302807d9f9cf5a"),Lt=n("b5d2e10ba1e6f6e55381"),jt=a.a.createElement("span",null),At=a.a.createElement("input",{id:"headlessBrowserRenderSign",type:"hidden"});var Dt=function(e){var t,n;return e.renderSign?(e.parentNode&&(t=e.parentNode.offsetWidth,n=e.parentNode.offsetHeight),a.a.createElement(a.a.Fragment,null,At,a.a.createElement("input",{id:"width",type:"hidden",value:t}),a.a.createElement("input",{id:"height",type:"hidden",value:n}))):jt},Et=n("dde802e9900958f55da9"),_t=function(e){return e.get("shareDashboard")},kt=n("e54a068d600ce8162b8c"),Ct=n("545cc1d5b2c0ab4381ef"),Tt=(n("c099c4fc48cd9bb84110"),n("21700e306353b2e19c0b")),xt=n.n(Tt);function Pt(e){return(Pt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ft(e){return(Ft=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ht(e,t){return(Ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Nt=n("788b454b5eadc7b7f231"),Ut=a.a.createElement(xt.a,{type:"user"}),Wt=a.a.createElement(xt.a,{type:"unlock"}),zt=function(e){function t(e){var n,r,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,a=Ft(t).call(this,e),n=!a||"object"!==Pt(a)&&"function"!==typeof a?Vt(r):a,qt(Vt(n),"enterLogin",null),qt(Vt(n),"bindDocumentKeypress",function(){n.enterLogin=function(e){13===e.keyCode&&n.props.onLogin()},document.addEventListener("keypress",n.enterLogin,!1)}),qt(Vt(n),"unbindDocumentKeypress",function(){document.removeEventListener("keypress",n.enterLogin,!1),n.enterLogin=null}),n}var n,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ht(e,t)}(t,a.a.PureComponent),n=t,(r=[{key:"componentWillUnmount",value:function(){this.unbindDocumentKeypress()}},{key:"render",value:function(){var e=this.props,t=e.username,n=e.password,r=e.onChangeUsername,o=e.onChangePassword;return a.a.createElement("div",{className:Nt.form},a.a.createElement("div",{className:Nt.input},Ut,a.a.createElement("input",{placeholder:"\u7528\u6237\u540d",value:t,onFocus:this.bindDocumentKeypress,onBlur:this.unbindDocumentKeypress,onChange:r})),a.a.createElement("div",{className:Nt.input},Wt,a.a.createElement("input",{placeholder:"\u5bc6\u7801",type:"password",value:n,onFocus:this.bindDocumentKeypress,onBlur:this.unbindDocumentKeypress,onChange:o})))}}])&&Rt(n.prototype,r),o&&Rt(n,o),t}();function Yt(e){return(Yt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Bt(e){return(Bt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Gt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Kt(e,t){return(Kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jt=n("f3ae47cf584ff0a4203b"),Xt=n("788b454b5eadc7b7f231"),Zt=r.createElement(d.a,{title:"Login"}),$t=r.createElement(xt.a,{type:"loading"}),en=function(e){function t(e){var n,r,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,a=Bt(t).call(this,e),n=!a||"object"!==Yt(a)&&"function"!==typeof a?Gt(r):a,Qt(Gt(n),"changeUsername",function(e){n.setState({username:e.target.value.trim()})}),Qt(Gt(n),"changePassword",function(e){n.setState({password:e.target.value})}),Qt(Gt(n),"doLogin",function(){var e=n.props,t=e.onLogin,r=e.shareInfo,a=e.legitimateUser,o=n.state,i=o.username,c=o.password;i&&c&&t(i,c,r,function(){a()})}),n.state={username:"",password:""},n}var a,o,i;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kt(e,t)}(t,r["PureComponent"]),a=t,(o=[{key:"render",value:function(){var e=this.props.loginLoading,t=this.state,a=t.username,o=t.password;return r.createElement("div",{className:"".concat(Jt.container," ").concat(Jt.share)},Zt,r.createElement("img",{className:Jt.logo,src:n("43a863c5e801a2996d08")}),r.createElement("div",{className:"".concat(Jt.window," ").concat(Xt.window)},r.createElement(zt,{username:a,password:o,onChangeUsername:this.changeUsername,onChangePassword:this.changePassword,onLogin:this.doLogin}),r.createElement("button",{disabled:e,onClick:this.doLogin},e?$t:"","\u767b \u5f55")))}}])&&Mt(a.prototype,o),i&&Mt(a,i),t}();var tn=Object(i.connect)(null,function(e){return{onLogin:function(t,n,r,a){return e(function(e,t,n,r){return{type:g,payload:{username:e,password:t,shareInfo:n,resolve:r}}}(t,n,r,a))}}})(en);function nn(e){return(nn="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rn(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function an(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){dn(e,t,n[t])})}return e}function on(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function cn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ln(e){return(ln=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function sn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function un(e,t){return(un=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function dn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fn,pn=Et.a.loadViewsDetail,bn=n("c7b06d3320a5509f12ff"),gn=Object(St.b)(St.a);!function(e){e[e.Initial=0]="Initial",e[e.Fulfilled=1]="Fulfilled",e[e.Error=2]="Error"}(fn||(fn={}));var mn=a.a.createElement("h3",null,"\u6570\u636e\u52a0\u8f7d\u4e2d\u2026\u2026"),yn=function(e){function t(e){var n,r,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,a=ln(t).call(this,e),n=!a||"object"!==nn(a)&&"function"!==typeof a?sn(r):a,dn(sn(n),"interactCallbacks",{}),dn(sn(n),"interactingLinkagers",{}),dn(sn(n),"interactGlobalFilters",{}),dn(sn(n),"resizeSign",0),dn(sn(n),"shareClientId",function(){var e="";try{(e=localStorage.getItem("SHARE_CLIENT_ID"))||(e=Object(L.d)(32),localStorage.setItem("SHARE_CLIENT_ID",e))}catch(e){K.a.error("\u83b7\u53d6\u5206\u4eab\u9875\u5ba2\u6237\u7aefID\u5931\u8d25\uff1a".concat(e.message))}return e}()),dn(sn(n),"downloadListPollingTimer",void 0),dn(sn(n),"loadShareContent",function(e){var t=n.props,r=t.onLoadDashboard,a=t.onLoadWidget,o=t.onSetIndividualDashboard;"dashboard"===e.type?r(e.shareInfo,function(e){403===e.response.status&&n.setState({showLogin:!0})}):a(e.shareInfo,function(t){o(t.id,e.shareInfo)},function(e){403===e.response.status&&n.setState({showLogin:!0})})}),dn(sn(n),"querystring",function(e){return e.split("&").reduce(function(e,t){var r=on(t.split("="),2),a=r[0],o=r[1];return o?(n.deep_set(e,a.split(/[\[\]]/g).filter(function(e){return e}),o),e):e},{})}),dn(sn(n),"getChartData",function(e,t,r,a){n.getData(n.props.onLoadResultset,e,t,r,a)}),dn(sn(n),"initPolling",function(e){n.props.onLoadDownloadList(n.shareClientId,e),n.downloadListPollingTimer=window.setInterval(function(){n.props.onLoadDownloadList(n.shareClientId,e)},Ct.w)}),dn(sn(n),"initiateWidgetDownloadTask",function(e,t){var r=n.props.widgets.find(function(e){return e.id===t}),a={nativeQuery:!1};try{var o=JSON.parse(r.config),i=o.mode,c=o.selectedChart,l=o.chartStyles;"chart"===i&&c===Object(kt.w)().id&&(a.nativeQuery=l.table.withNoAggregators)}catch(e){K.a.error(e)}n.getData(function(e,r,a,o){var i=[an({},o,{id:t})];n.props.onInitiateDownloadTask(n.shareClientId,a,ke.b.Widget,i,r)},"rerender",e,t,a)}),dn(sn(n),"getData",function(e,t,r,a,o){var i,c,l,s,u,d,f,p,b,g,m=n.props,y=m.currentItemsInfo,h=m.widgets.find(function(e){return e.id===a}),v=JSON.parse(h.config),O=v.cols,S=v.rows,w=v.metrics,I=v.secondaryMetrics,L=v.filters,j=v.color,A=v.label,D=v.size,E=v.xAxis,_=v.tip,k=v.orders,C=v.cache,T=v.expired,x=O.map(function(e){return Object(_e.d)(e)}),P=S.map(function(e){return Object(_e.d)(e)}),R=x.concat(P).filter(function(e){var t=e.sort;return t&&t.sortType===Ce.a.Custom}).map(function(e){return{name:e.name,list:e.sort[Ce.a.Custom].sortList}}),F=y[r].queryConditions;o?(i=void 0!==o.tempFilters?o.tempFilters:F.tempFilters,c=void 0!==o.linkageFilters?o.linkageFilters:F.linkageFilters,l=void 0!==o.globalFilters?o.globalFilters:F.globalFilters,s=void 0!==o.orders?o.orders:F.orders,u=o.variables||F.variables,d=o.linkageVariables||F.linkageVariables,f=o.globalVariables||F.globalVariables,p=o.drillStatus||void 0,b=o.pagination||F.pagination,g=o.nativeQuery||F.nativeQuery):(i=F.tempFilters,c=F.linkageFilters,l=F.globalFilters,s=F.orders,u=F.variables,d=F.linkageVariables,f=F.globalVariables,b=F.pagination,g=F.nativeQuery);var V=O.concat(S).filter(function(e){return"\u6307\u6807\u540d\u79f0"!==e.name}).map(function(e){return e.name}),H=w.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}});I&&I.length&&(H=H.concat(I.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}}))),j&&(V=V.concat(j.items.map(function(e){return e.name}))),A&&(V=V.concat(A.items.filter(function(e){return"category"===e.type}).map(function(e){return e.name})),H=H.concat(A.items.filter(function(e){return"value"===e.type}).map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}}))),D&&(H=H.concat(D.items.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}}))),E&&(H=H.concat(E.items.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}}))),_&&(H=H.concat(_.items.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}})));var q=L.reduce(function(e,t){return e.concat(t.config.sqlModel)},[]),N={groups:p&&p.groups?p.groups:V,aggregators:H,filters:p&&p.filter?p.filter.sqls:q,tempFilters:i,linkageFilters:c,globalFilters:l,variables:u,linkageVariables:d,globalVariables:f,orders:k,cache:C,expired:T,flush:"flush"===t,pagination:b,nativeQuery:g,customOrders:R};s&&(N.orders=N.orders.concat(s)),e(t,r,h.dataToken,N)}),dn(sn(n),"onWindowResize",function(){n.resizeSign&&clearTimeout(n.resizeSign),n.resizeSign=window.setTimeout(function(){n.props.onResizeAllDashboardItem(),clearTimeout(n.resizeSign),n.resizeSign=0},500)}),dn(sn(n),"visibleFullScreen",function(e){var t=n.state.allowFullScreen;e&&n.setState({currentDataInFullScreen:e}),n.setState({allowFullScreen:!t})}),dn(sn(n),"currentWidgetInFullScreen",function(e){var t=n.props,r=t.currentItems,a=t.currentItemsInfo,o=t.widgets,i=r.find(function(t){return t.id===e}),c=o.find(function(e){return e.id===i.widgetId}),l=a[e],s=a.loading;n.setState({currentDataInFullScreen:{itemId:e,widgetId:c.id,widget:c,data:l,loading:s,onGetChartData:n.getChartData}})}),dn(sn(n),"handleLegitimateUser",function(){var e=n.state,t=e.type,r=e.shareInfo;n.setState({showLogin:!1},function(){n.loadShareContent({type:t,shareInfo:r})})}),dn(sn(n),"checkInteract",function(e){return n.props.linkages.some(function(t){return+t.trigger[0]===e})}),dn(sn(n),"doInteract",function(e,t){var r=n.props,a=r.currentItems,o=r.linkages,i=Object(ht.a)(e,o);n.interactingLinkagers=Object(ht.b)(e,t,i,n.interactingLinkagers),Object.keys(i).forEach(function(e){var t=a.find(function(t){return t.id===+e}),r=n.interactingLinkagers[e],o=r.filters,i=r.variables;n.getChartData("rerender",+e,t.widgetId,{linkageFilters:Object.values(o).reduce(function(e,t){return e.concat.apply(e,rn(t))},[]),linkageVariables:Object.values(i).reduce(function(e,t){return e.concat.apply(e,rn(t))},[])})}),n.setState({interactingStatus:an({},n.state.interactingStatus,dn({},e,!0))})}),dn(sn(n),"turnOffInteract",function(e){var t=n.props,r=t.linkages,a=t.currentItems;Object(ht.c)(e,r,n.interactingLinkagers).forEach(function(e){var t=a.find(function(t){return t.id===e}),r=n.interactingLinkagers[e],o=r.filters,i=r.variables;n.getChartData("rerender",e,t.widgetId,{linkageFilters:Object.values(o).reduce(function(e,t){return e.concat.apply(e,rn(t))},[]),linkageVariables:Object.values(i).reduce(function(e,t){return e.concat.apply(e,rn(t))},[])})}),n.setState({interactingStatus:an({},n.state.interactingStatus,dn({},e,!1))},function(){var t=a.find(function(t){return t.id===e});n.getChartData("clear",e,t.widgetId)})}),dn(sn(n),"getOptions",function(e,t,r,a){t?n.props.onSetSelectOptions(e,r,a):n.props.onLoadSelectOptions(e,n.state.shareInfo,r,a)}),dn(sn(n),"globalControlChange",function(e){n.props.onGlobalControlChange(e)}),dn(sn(n),"globalControlSearch",function(e){var t=n.props,r=t.currentItems,a=t.widgets,o=t.currentItemsInfo;e.forEach(function(e){var t=r.find(function(t){return t.id===e});if(t){var i=a.find(function(e){return e.id===t.widgetId}),c=o[e].queryConditions.pagination,l=!1;try{var s=JSON.parse(i.config),u=s.mode,d=s.selectedChart,f=s.chartStyles;"chart"===u&&d===Object(kt.w)().id&&f.table.withPaging&&(c=an({pageSize:Number(f.table.pageSize)},c,{pageNo:Ct.v}),l=f.table.withNoAggregators)}catch(e){K.a.error(e)}n.getChartData("rerender",e,t.widgetId,{pagination:c,nativeQuery:l})}})}),dn(sn(n),"globalFilterChange",function(e){var t=n.props,r=t.currentItems,a=t.currentItemsInfo;Object.entries(e).forEach(function(e){var t=on(e,2),o=t[0],i=t[1],c=r.find(function(e){return e.id===+o});if(c){var l=0,s=a[o].queryConditions.pagination;s.pageNo&&(l=1);var u=i.variables,d=i.filters;n.getChartData("rerender",+o,c.widgetId,{globalVariables:u,globalFilters:d,pagination:an({},s,{pageNo:l})})}})}),dn(sn(n),"dataDrill",function(e){var t=n.props,r=t.widgets,a=t.currentItemsInfo,o=t.onDrillDashboardItem,i=e.itemId,c=e.groups,l=e.widgetId,s=e.sourceDataFilter,u=e.mode,d=e.col,f=e.row,p=r.find(function(e){return e.id===l}),b=JSON.parse(p.config),g=b.cols,m=b.rows,y=b.metrics,h=(b.filters,b.color),v=b.label,O=(b.size,b.xAxis,b.tip,b.orders,b.cache,b.expired,b.model),S=a[i].queryConditions.drillHistory,w=void 0,I=void 0,L=void 0,j=g.concat(m).filter(function(e){return"\u6307\u6807\u540d\u79f0"!==e.name}).map(function(e){return e.name}),A=y.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}});h&&(j=j.concat(h.items.map(function(e){return e.name}))),v&&(j=j.concat(v.items.filter(function(e){return"category"===e.type}).map(function(e){return e.name})),A=A.concat(v.items.filter(function(e){return"value"===e.type}).map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}})));var D=void 0,E=[],_=[],k=[],C=[];if(b.filters.forEach(function(e){C=C.concat(e.config.sqlModel)}),S&&0!==S.length){var T=S[S.length-1],x=void 0,P=void 0;if("chart"===u&&b.selectedChart===wt.a.Table){var R=s.reduce(function(e,t){return void 0===e[t.key]?e[t.key]=[t.value]:e[t.key].push(t.value),e},{});for(var F in R)void 0!==R[F]&&F&&function(){var e=O[F]&&O[F].sqlType?O[F].sqlType:"VARCHAR",t={name:F,operator:"in",type:"filter",value:R[F].map(function(t){return Object(Ee.l)(t,e)}),sqlType:e};k.push(t)}();if(Array.isArray(k)&&k.length>0&&(C=C.concat(k)),T&&T.col&&T.col.length){var V=s[s.length-1].key,H=T.col.reduce(function(e,t){return e.push(t),t.name===V&&e.push({name:c}),e},[]);x=c&&c.length?H:T.col}}else{I=T.groups[T.groups.length-1],L=s.map(function(e){return e[I]});var q=O[I]&&O[I].sqlType?O[I].sqlType:"VARCHAR";w={name:I,operator:"in",type:"filter",value:L.map(function(e){return Object(Ee.l)(e,q)}),sqlType:q},C=T.filter.sqls.concat(w),x=d&&d.length?(T.col||[]).concat({name:d}):T.col,P=f&&f.length?(T.row||[]).concat({name:f}):T.row}var N=T.groups.some(function(e){return e===c}),U=void 0;U=N?T.groups.filter(function(e){return e!==c}):"pivot"===u?T.groups.concat([c]):"chart"===u&&b.selectedChart===wt.a.Table?T.groups.concat([c]):[c],D={filter:{filterSource:L,name:I,sql:w,sqls:C,visualType:"string"},col:x,row:P,type:N?"up":"down",groups:U,name:c}}else{var W=void 0;if(b){var z=b.dimetionAxis;E=b.rows&&b.rows.length?b.rows:[],_=b.cols&&b.cols.length?b.cols:[];var Y=b.mode;if(Y&&"pivot"===Y)if(g&&0!==g.length){var M=b.cols;I=M[M.length-1].name}else{var B=b.rows;I=B[B.length-1].name}else if("col"===z){var G=b.cols;I=G[G.length-1].name}else if("row"===z){var K=b.rows;I=K[K.length-1].name}else if("chart"===Y&&b.selectedChart===wt.a.Table){var Q=s.reduce(function(e,t){return void 0===e[t.key]?e[t.key]=[t.value]:e[t.key].push(t.value),e},{});for(var J in Q)void 0!==Q[J]&&J&&function(){var e=O[J]&&O[J].sqlType?O[J].sqlType:"VARCHAR",t={name:J,operator:"in",type:"filter",value:Q[J].map(function(t){return Object(Ee.l)(t,e)}),sqlType:e};k.push(t)}();var X=s[s.length-1].key,Z=_.reduce(function(e,t){return e.push(t),t.name===X&&e.push({name:c}),e},[]);W=c&&c.length?Z:void 0}}if(L=s.map(function(e){if(e&&e[I])return e[I]}),I&&I.length){W=d&&d.length?_.concat([{name:d}]):void 0;var $=O[I]&&O[I].sqlType?O[I].sqlType:"VARCHAR";w={name:I,operator:"in",type:"filter",value:L.map(function(e){return Object(Ee.l)(e,$)}),sqlType:$},C.push(w)}Array.isArray(k)&&k.length>0&&(C=C.concat(k));var ee=j.some(function(e){return e===c}),te=void 0;te=ee?j.filter(function(e){return e!==c}):"pivot"===u?j.concat([c]):"chart"===u&&b.selectedChart===wt.a.Table?j.concat([c]):[c],D={filter:{filterSource:L,name:I,sql:w,sqls:C,visualType:"string"},type:ee?"up":"down",col:W,row:f&&f.length?E.concat([{name:f}]):void 0,groups:te,name:c}}o(i,D),n.getChartData("rerender",i,l,{drillStatus:D})}),dn(sn(n),"selectDrillHistory",function(e,t,r,a){var o=n.props,i=(o.currentItemsInfo,o.onDeleteDrillHistory);e?n.getChartData("rerender",r,a,{drillStatus:e}):n.getChartData("rerender",r,a),i(r,t)}),dn(sn(n),"selectChartsItems",function(e,t,r){(0,n.props.onSelectDashboardItemChart)(e,t,r)}),dn(sn(n),"loadDownloadList",function(){n.props.onLoadDownloadList(n.shareClientId,n.state.shareInfo)}),dn(sn(n),"downloadFile",function(e){n.props.onDownloadFile(e,n.shareClientId,n.state.shareInfo)}),n.state={type:"",shareInfo:"",views:{},modalLoading:!1,interactingStatus:{},allowFullScreen:!1,currentDataInFullScreen:{},showLogin:!1,headlessBrowserRenderSign:!1,controlTokenMapping:{}},n}var n,r,o;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&un(e,t)}(t,a.a.Component),n=t,(r=[{key:"componentWillMount",value:function(){var e=this.querystring(location.href.substr(location.href.indexOf("?")+1));this.setState({type:e.type,shareInfo:e.shareInfo}),this.loadShareContent(e),this.initPolling(e.shareInfo),delete e.type,delete e.shareInfo,this.props.onSendShareParams(e)}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onWindowResize,!1)}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=e.currentItems,r=e.currentItemsInfo,a=(e.dashboard,e.widgets);if(a&&a!==this.props.widgets)try{this.setState({views:a.reduce(function(e,t){return an({},e,dn({},t.id,{model:JSON.parse(t.model)}))},{})})}catch(e){K.a.error(e)}r&&(Object.values(r).filter(function(e){return[fn.Fulfilled,fn.Error].includes(e.status)}).length===n.length&&setTimeout(function(){t.setState({headlessBrowserRenderSign:!0})},5e3))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onWindowResize,!1),this.downloadListPollingTimer&&clearInterval(this.downloadListPollingTimer)}},{key:"deep_set",value:function(e,t,n){for(var r=0;r<t.length-1;r++)void 0===e[t[r]]&&(e[t[r]]=t[r+1].match(/^\d+$/)?[]:{}),e=e[t[r]];e[t[r]]=decodeURIComponent(n)}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.dashboard,o=n.title,i=n.currentItems,c=n.currentItemsInfo,l=n.widgets,s=n.linkages,u=n.dashboardSelectOptions,f=n.downloadList,p=this.state,b=(p.shareInfo,p.showLogin),g=p.views,m=p.interactingStatus,y=p.allowFullScreen,h=p.headlessBrowserRenderSign,v=null,O=null;if(i){var S=[],w={lg:[]};i.forEach(function(e){var n=e.id,r=e.x,o=e.y,i=e.width,u=e.height,d=e.widgetId,f=e.polling,p=e.frequency,b=c[n],y=b.datasource,h=b.loading,v=b.downloadCsvLoading,O=b.renderType,I=b.queryConditions,L=b.controlSelectOptions,j=b.selectedItems,A=b.errorMessage,D=l.find(function(e){return e.id===d}),E=g[d],_=m[n]||!1,k=I.drillHistory,C=!(!s||!s.length)&&s.map(function(e){return e.trigger[0]}).some(function(e){return e===String(n)});S.push(a.a.createElement("div",{key:n},a.a.createElement(vt.a,{itemId:n,widget:D,widgets:l,view:E,isTrigger:C,datasource:y,loading:h,polling:f,onDrillData:t.dataDrill,onSelectDrillHistory:t.selectDrillHistory,interacting:_,drillHistory:k,frequency:p,shareInfo:D.dataToken,downloadCsvLoading:v,renderType:O,controlSelectOptions:L,queryConditions:I,errorMessage:A,onGetChartData:t.getChartData,onDownloadCsv:t.initiateWidgetDownloadTask,onTurnOffInteract:t.turnOffInteract,onCheckTableInteract:t.checkInteract,onDoTableInteract:t.doInteract,onShowFullScreen:t.visibleFullScreen,onGetControlOptions:t.getOptions,container:"share",selectedItems:j||[],onSelectChartsItems:t.selectChartsItems}))),w.lg.push({x:r,y:o,w:i,h:u,i:"".concat(n)})}),v=a.a.createElement(gn,{className:"layout",style:{marginTop:"-16px"},rowHeight:Ct.A,margin:[Ct.z,Ct.z],breakpoints:Ct.x,cols:Ct.y,layouts:w,measureBeforeMount:!1,useCSSTransforms:!1,isDraggable:!1,isResizable:!1},S),O=a.a.createElement(Ot.a,{widgets:l,currentItems:i,currentDashboard:{widgets:i},currentItemsInfo:c,visible:y,isVisible:this.visibleFullScreen,currentDataInFullScreen:this.state.currentDataInFullScreen,onCurrentWidgetInFullScreen:this.currentWidgetInFullScreen})}else v=a.a.createElement("div",{className:bn.shareContentEmpty},mn),O="";e=b?a.a.createElement(tn,{shareInfo:this.state.shareInfo,legitimateUser:this.handleLegitimateUser}):"";var I=document.getElementById("app");return a.a.createElement(yt.a,null,a.a.createElement(d.a,{title:o}),a.a.createElement(yt.a.Title,null,a.a.createElement(Y.a,null,a.a.createElement(B.a,{span:24},a.a.createElement("h2",{className:bn.shareTitle},o),a.a.createElement("div",{className:bn.shareDownloadListToggle},a.a.createElement(Lt.a,{downloadList:f,onLoadDownloadList:this.loadDownloadList,onDownloadFile:this.downloadFile})))),a.a.createElement(It.a,{currentDashboard:r,currentItems:i,onGetOptions:this.getOptions,mapOptions:u,onChange:this.globalControlChange,onSearch:this.globalControlSearch})),v,a.a.createElement("div",{className:bn.gridBottom}),O,e,a.a.createElement(Dt,{renderSign:h,parentNode:I}))}}])&&cn(n.prototype,r),o&&cn(n,o),t}(),hn=Object(Q.b)({dashboard:Object(Q.a)(_t,function(e){return e.get("dashboard")}),title:Object(Q.a)(_t,function(e){return e.get("title")}),config:Object(Q.a)(_t,function(e){return e.get("config")}),widgets:Object(Q.a)(_t,function(e){return e.get("widgets")}),currentItems:Object(Q.a)(_t,function(e){return e.get("items")}),currentItemsInfo:Object(Q.a)(_t,function(e){return e.get("itemsInfo")}),dashboardSelectOptions:Object(Q.a)(_t,function(e){return e.get("dashboardSelectOptions")}),linkages:Object(Q.a)(_t,function(e){var t=e.get("config");if(!t)return[];var n=JSON.parse(t||{}).linkages;if(!n)return[];var r=e.get("itemsInfo");return n.filter(function(e){var t=e.linkager,n=e.trigger;return r[t[0]]&&r[n[0]]})}),downloadList:Object(Q.a)(_t,function(e){return e.get("downloadList")}),shareParams:Object(Q.a)(_t,function(e){return e.get("shareParams")})});var vn,On=Object(i.connect)(hn,function(e){return{onLoadViewsDetail:function(t,n){return e(pn(t,n))},onLoadDashboard:function(t,n){return e(function(e,t){return{type:J,payload:{token:e,reject:t}}}(t,n))},onLoadWidget:function(t,n,r){return e(function(e,t,n){return{type:ee,payload:{token:e,resolve:t,reject:n}}}(t,n,r))},onLoadResultset:function(t,n,r,a){return e(function(e,t,n,r){return{type:ne,payload:{renderType:e,itemId:t,dataToken:n,requestParams:r}}}(t,n,r,a))},onSetIndividualDashboard:function(t,n){return e(function(e,t){return{type:$,payload:{widgetId:e,token:t}}}(t,n))},onLoadWidgetCsv:function(t,n,r){return e(function(e,t,n){return{type:oe,payload:{itemId:e,requestParams:t,token:n}}}(t,n,r))},onLoadSelectOptions:function(t,n,r,a){return e(function(e,t,n,r){return{type:le,payload:{controlKey:e,dataToken:t,requestParams:n,itemId:r}}}(t,n,r,a))},onSetSelectOptions:function(t,n,r){return e(function(e,t,n){return{type:be,payload:{controlKey:e,options:t,itemId:n}}}(t,n,r))},onResizeAllDashboardItem:function(){return e({type:de})},onDrillDashboardItem:function(t,n){return e(function(e,t){return{type:fe,payload:{itemId:e,drillHistory:t}}}(t,n))},onDeleteDrillHistory:function(t,n){return e(function(e,t){return{type:pe,payload:{itemId:e,index:t}}}(t,n))},onSelectDashboardItemChart:function(t,n,r){return e(function(e,t,n){return{type:ge,payload:{itemId:e,renderType:t,selectedItems:n}}}(t,n,r))},onGlobalControlChange:function(t){return e(function(e){return{type:me,payload:{controlRequestParamsByItem:e}}}(t))},onInitiateDownloadTask:function(t,n,r,a){return e(function(e,t,n,r,a){return{type:Le,payload:{shareClientId:e,dataToken:t,type:n,downloadParams:r,itemId:a}}}(t,n,r,a))},onLoadDownloadList:function(t,n){return e(function(e,t){return{type:he,payload:{shareClinetId:e,token:t}}}(t,n))},onDownloadFile:function(t,n,r){return e(function(e,t,n){return{type:Se,payload:{id:e,shareClinetId:t,token:n}}}(t,n,r))},onSendShareParams:function(t){return e(function(e){return{type:ye,payload:{params:e}}}(t))}}}),Sn=Object(p.a)({key:"shareDashboard",reducer:Fe}),wn=Object(b.a)({key:"shareDashboard",saga:mt}),In=Object(f.compose)(Sn,wn,On)(yn),Ln=n("fdb445ec61a8d515506e");!function(e){e.LOAD_SHARE_DISPLAY="davinci/Share/LOAD_SHARE_DISPLAY",e.LOAD_SHARE_DISPLAY_SUCCESS="davinci/Share/LOAD_SHARE_DISPLAY_SUCCESS",e.LOAD_SHARE_DISPLAY_FAILURE="davinci/Share/LOAD_SHARE_DISPLAY_FAILURE",e.LOAD_LAYER_DATA="davinci/Share/LOAD_LAYER_DATA",e.LOAD_LAYER_DATA_SUCCESS="davinci/Share/LOAD_LAYER_DATA_SUCCESS",e.LOAD_LAYER_DATA_FAILURE="davinci/Share/LOAD_LAYER_DATA_FAILURE"}(vn||(vn={}));var jn=Object(Ln.a)(vn),An=n("af45b63fe9fc857a79a4");function Dn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){En(e,t,n[t])})}return e}function En(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _n=Object(h.fromJS)({title:"",display:null,slide:null,layers:[],layersInfo:{},widgets:[]});var kn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_n,t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload,a=e.get("layersInfo");switch(n){case jn.LOAD_SHARE_DISPLAY_SUCCESS:return e.set("title",r.display.name).set("display",r.display).set("slide",r.slide).set("layers",r.slide?r.slide.relations:[]).set("widgets",r.widgets).set("layersInfo",r.slide?r.slide.relations.reduce(function(e,t){return e[t.id]=t.type===An.a.Chart?{status:fn.Initial,datasource:{resultList:[]},loading:!0,queryConditions:{tempFilters:[],linkageFilters:[],globalFilters:[],variables:[],linkageVariables:[],globalVariables:[]},interactId:"",renderType:"rerender"}:{loading:!1},e},{}):[]);case jn.LOAD_SHARE_DISPLAY_FAILURE:return e.set("display",null).set("slide",null).set("layers",[]).set("widgets",[]).set("layersInfo",{});case jn.LOAD_LAYER_DATA:return e.set("layersInfo",Dn({},a,En({},r.layerId,Dn({},a[r.layerId],{loading:!0}))));case jn.LOAD_LAYER_DATA_SUCCESS:return Object(Ce.c)(r.data.resultList,r.requestParams.customOrders),e.set("layersInfo",Dn({},a,En({},r.layerId,Dn({},a[r.layerId],{status:fn.Fulfilled,loading:!1,datasource:r.data,renderType:r.renderType}))));case jn.LOAD_LAYER_DATA_FAILURE:return e.set("loadings",Dn({},a,En({},r.layerId,Dn({},a[r.layerId],{status:fn.Error,loading:!1}))));default:return e}},Cn={loadDisplay:function(e,t,n){return{type:jn.LOAD_SHARE_DISPLAY,payload:{token:e,resolve:t,reject:n}}},displayLoaded:function(e,t,n){return{type:jn.LOAD_SHARE_DISPLAY_SUCCESS,payload:{display:e,slide:t,widgets:n}}},loadDisplayFail:function(e){return{type:jn.LOAD_SHARE_DISPLAY_FAILURE,payload:{error:e}}},loadLayerData:function(e,t,n,r){return{type:jn.LOAD_LAYER_DATA,payload:{renderType:e,layerId:t,dataToken:n,requestParams:r}}},layerDataLoaded:function(e,t,n,r){return{type:jn.LOAD_LAYER_DATA_SUCCESS,payload:{renderType:e,layerId:t,data:n,requestParams:r}}},loadLayerDataFail:function(e){return{type:jn.LOAD_LAYER_DATA_FAILURE,payload:{error:e}}}},Tn=(Object(Ln.b)(Cn),Cn);function xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Pn(e,t,n[t])})}return e}function Pn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rn(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Fn=regeneratorRuntime.mark(qn),Vn=regeneratorRuntime.mark(Nn),Hn=regeneratorRuntime.mark(Un);function qn(e){var t,n,r,a,o,i,c,l,s,u,d,f;return regeneratorRuntime.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(e.type===jn.LOAD_SHARE_DISPLAY){p.next=2;break}return p.abrupt("return");case 2:return t=e.payload,n=t.token,r=t.resolve,a=t.reject,o=Tn.loadDisplayFail,i=Tn.displayLoaded,p.prev=4,p.next=7,Object(w.b)(I.a,"".concat(j.a.share,"/display/").concat(n));case 7:if(c=p.sent,l=c.header,s=c.payload,401!==l.code){p.next=14;break}return a(l.msg),p.next=13,Object(w.c)(o(l.msg));case 13:return p.abrupt("return");case 14:return d=(u=s).slides,f=u.widgets,p.next=18,Object(w.c)(i(u,d[0],f||[]));case 18:r(u,d[0],f),p.next=28;break;case 21:return p.prev=21,p.t0=p.catch(4),K.a.destroy(),p.next=26,Object(w.c)(o(p.t0));case 26:K.a.error("\u83b7\u53d6 Display \u4fe1\u606f\u5931\u8d25\uff0c\u8bf7\u5237\u65b0\u91cd\u8bd5"),a(p.t0);case 28:case"end":return p.stop()}},Fn,null,[[4,21]])}function Nn(e){var t,n,r,a,o,i,c,l,s,u,d,f,p,b,g,m,y,h,v,O,S;return regeneratorRuntime.wrap(function(L){for(;;)switch(L.prev=L.next){case 0:if(e.type===jn.LOAD_LAYER_DATA){L.next=2;break}return L.abrupt("return");case 2:return t=e.payload,n=t.renderType,r=t.layerId,a=t.dataToken,o=t.requestParams,i=o.filters,c=o.tempFilters,l=o.linkageFilters,s=o.globalFilters,u=o.variables,d=o.linkageVariables,f=o.globalVariables,p=o.pagination,b=Rn(o,["filters","tempFilters","linkageFilters","globalFilters","variables","linkageVariables","globalVariables","pagination"]),m=(g=p||{pageSize:0,pageNo:0}).pageSize,y=g.pageNo,h=Tn.layerDataLoaded,v=Tn.loadLayerDataFail,L.prev=6,L.next=9,Object(w.b)(I.a,{method:"post",url:"".concat(j.a.share,"/data/").concat(a),data:xn({},He()(b,"customOrders"),{filters:i.concat(c).concat(l).concat(s),params:u.concat(d).concat(f),pageSize:m,pageNo:y})});case 9:return O=L.sent,S=O.payload.resultList,O.payload.resultList=S&&S.slice(0,600)||[],L.next=14,Object(w.c)(h(n,r,O.payload,o));case 14:L.next=20;break;case 16:return L.prev=16,L.t0=L.catch(6),L.next=20,Object(w.c)(v(L.t0));case 20:case"end":return L.stop()}},Vn,null,[[6,16]])}function Un(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,[Object(S.c)(jn.LOAD_SHARE_DISPLAY,qn),Object(S.b)(jn.LOAD_LAYER_DATA,Nn)];case 2:case"end":return e.stop()}},Hn)}var Wn=n("f10f809a0f3792f3a22d"),zn=function(e){return e.get("shareDisplay")};function Yn(e){return(Yn="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Bn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gn(e){return(Gn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Kn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qn(e,t){return(Qn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Jn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Xn=n("6a7fad1b7c06479779b2"),Zn=n("26317c735995b6f84276"),$n=Tn.loadDisplay,er=Tn.loadLayerData,tr=function(e){function t(e){var n,a,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,o=Gn(t).call(this,e),n=!o||"object"!==Yn(o)&&"function"!==typeof o?Kn(a):o,Jn(Kn(n),"charts",{}),Jn(Kn(n),"displayCanvas",Object(r.createRef)()),Jn(Kn(n),"getChartData",function(e,t,r,a){var o,i,c,l,s,u,d,f,p,b=n.props,g=b.widgets,m=b.layersInfo,y=b.onLoadLayerData,h=g.find(function(e){return e.id===r}),v=JSON.parse(h.config),O=v.cols,S=v.rows,w=v.metrics,I=v.secondaryMetrics,L=v.filters,j=v.color,A=v.label,D=v.size,E=v.xAxis,_=v.tip,k=v.orders,C=v.cache,T=v.expired,x=O.map(function(e){return Object(_e.d)(e)}),P=S.map(function(e){return Object(_e.d)(e)}),R=x.concat(P).filter(function(e){var t=e.sort;return t&&t.sortType===Ce.a.Custom}).map(function(e){return{name:e.name,list:e.sort[Ce.a.Custom].sortList}}),F=m[t].queryConditions;a?(o=void 0!==a.tempFilters?a.tempFilters:F.tempFilters,i=void 0!==a.linkageFilters?a.linkageFilters:F.linkageFilters,c=void 0!==a.globalFilters?a.globalFilters:F.globalFilters,l=void 0!==a.orders?a.orders:F.orders,s=a.variables||F.variables,u=a.linkageVariables||F.linkageVariables,d=a.globalVariables||F.globalVariables,f=a.pagination||F.pagination,p=a.nativeQuery||F.nativeQuery):(o=F.tempFilters,i=F.linkageFilters,c=F.globalFilters,l=F.orders,s=F.variables,u=F.linkageVariables,d=F.globalVariables,f=F.pagination,p=F.nativeQuery);var V=O.concat(S).filter(function(e){return"\u6307\u6807\u540d\u79f0"!==e.name}).map(function(e){return e.name}),H=w.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}});I&&I.length&&(H=H.concat(I.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}}))),j&&(V=V.concat(j.items.map(function(e){return e.name}))),A&&(V=V.concat(A.items.filter(function(e){return"category"===e.type}).map(function(e){return e.name})),H=H.concat(A.items.filter(function(e){return"value"===e.type}).map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}}))),D&&(H=H.concat(D.items.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}}))),E&&(H=H.concat(E.items.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}}))),_&&(H=H.concat(_.items.map(function(e){return{column:Object(kt.b)(e.name),func:e.agg}})));var q={groups:V,aggregators:H,filters:L.reduce(function(e,t){return e.concat(t.config.sqlModel)},[]),tempFilters:o,linkageFilters:i,globalFilters:c,variables:s,linkageVariables:u,globalVariables:d,orders:k,cache:C,expired:T,flush:"flush"===e,pagination:f,nativeQuery:p,customOrders:R};l&&(q.orders=q.orders.concat(l)),y(e,t,h.dataToken,q)}),Jn(Kn(n),"getPreviewStyle",function(e){var t={};switch(e.scaleMode){case"scaleWidth":t.overflowY="auto";break;case"scaleHeight":t.overflowX="auto";break;case"noScale":t.overflow="auto"}return t}),Jn(Kn(n),"getSlideStyle",function(e,t){var n,r=e.width,a=e.height,o=e.scaleMode,i=e.backgroundColor,c=e.backgroundImage,l=document.body,s=l.clientWidth,u=l.clientHeight,d=Mn(t,2),f=d[0],p=d[1],b=(f-1)/2,g=(p-1)/2;b+=Math.max(0,(s-f*r)/(2*r)),g+=Math.max(0,(u-p*a)/(2*a));var m="translate(".concat(100*b,"%, ").concat(100*g,"%)"),y=n={overflow:"visible",width:r,height:a,transform:"".concat(m," scale(").concat(f,", ").concat(p,")")};if("scaleWidth"===o&&screen.width<=1024&&(y=document.body.style),y.backgroundSize="cover",i){var h=i.join();y.backgroundColor="rgba(".concat(h,")")}return c&&(y.backgroundImage='url("'.concat(c,'")')),n}),Jn(Kn(n),"loadShareContent",function(){(0,n.props.onLoadDisplay)(n.state.shareInfo,function(){console.log("share page need login...")},function(){n.setState({showLogin:!0})})}),Jn(Kn(n),"handleLegitimateUser",function(){n.setState({showLogin:!1},function(){n.loadShareContent()})}),n.state={scale:[1,1],showLogin:!1,shareInfo:"",headlessBrowserRenderSign:!1},n}var n,o,i;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qn(e,t)}(t,a.a.Component),n=t,(o=[{key:"componentWillMount",value:function(){var e=this,t=this.props.location.query.shareInfo;this.setState({shareInfo:t},function(){e.loadShareContent()})}},{key:"componentWillReceiveProps",value:function(e){var t=this,n=e.slide,r=e.layers,a=e.layersInfo,o=Mn(this.state.scale,2),i=o[0],c=o[1];if(n&&this.props.slide!==n){var l=JSON.parse(n.config).slideParams,s=l.scaleMode,u=l.width,d=l.height,f=document.body,p=f.clientHeight,b=f.clientWidth,g=1,m=1;switch(s){case"scaleHeight":m=g=p/d;break;case"scaleWidth":g=m=b/u;break;case"scaleFull":g=p/d,m=b/u}c===g&&i===m||this.setState({scale:[m,g]})}if(a){var y=r.filter(function(e){return e.type===An.a.Chart});Object.entries(a).filter(function(e){var t=Mn(e,2),n=t[0],r=t[1];return y.find(function(e){return e.id===Number(n)})&&[fn.Fulfilled,fn.Error].includes(r.status)}).length===y.length&&setTimeout(function(){t.setState({headlessBrowserRenderSign:!0})},5e3)}}},{key:"render",value:function(){var e=this,t=this.props,n=t.title,r=t.widgets,o=t.display,i=t.slide,c=t.layers,l=t.layersInfo,s=this.state,u=(s.scale,s.showLogin),f=s.shareInfo,p=s.headlessBrowserRenderSign,b=u?a.a.createElement(tn,{shareInfo:f,legitimateUser:this.handleLegitimateUser}):null,g=null,m=null;if(o){var y=this.state.scale,h=i?JSON.parse(i.config).slideParams:{};m=this.getPreviewStyle(h);var v=this.getSlideStyle(h,y),O=Array.isArray(r)?c.map(function(t){var n=r.find(function(e){return e.id===t.widgetId}),o=n&&JSON.parse(n.model),i=t.id,c=JSON.parse(t.params),s=c.polling,u=c.frequency,d=l[i],f=d.datasource,p=d.loading,b=d.interactId,g=d.renderType;return a.a.createElement(Wn.a,{key:t.id,pure:!0,itemId:i,widget:n,model:o,datasource:f,layer:t,loading:p,polling:s,frequency:u,interactId:b,renderType:g,onGetChartData:e.getChartData})}):null;g=a.a.createElement("div",{className:Zn.board,style:v,ref:this.displayCanvas},O)}return a.a.createElement("div",{className:Xn.container},a.a.createElement("div",{className:Zn.preview,style:m},a.a.createElement(d.a,{title:n}),g,b,a.a.createElement(Dt,{renderSign:p,parentNode:this.displayCanvas.current})))}}])&&Bn(n.prototype,o),i&&Bn(n,i),t}(),nr=Object(Q.b)({title:Object(Q.a)(zn,function(e){return e.get("title")}),display:Object(Q.a)(zn,function(e){return e.get("display")}),slide:Object(Q.a)(zn,function(e){return e.get("slide")}),layers:Object(Q.a)(zn,function(e){return e.get("layers")}),widgets:Object(Q.a)(zn,function(e){return e.get("widgets")}),layersInfo:Object(Q.a)(zn,function(e){return e.get("layersInfo")})});var rr=Object(i.connect)(nr,function(e){return{onLoadDisplay:function(t,n,r){return e($n(t,n,r))},onLoadLayerData:function(t,n,r,a){return e(er(t,n,r,a))}}}),ar=Object(p.a)({key:"shareDisplay",reducer:kn}),or=Object(b.a)({key:"shareDisplay",saga:Un}),ir=Object(f.compose)(ar,or,rr)(tr),cr=function(e){console.error("Dynamic page loading failed",e)},lr=function(e){return function(t){e(null,t.default)}};n("ed0aa665d8cc7f062de1"),n("1dad865dd74034286d56"),n("3670a75cdf40147fed09"),n("360199e61df61d70683e"),n("8a7df9b2a2fe5d99ea98"),n("c302bbd821e068aec7ca"),n("488186eb3b2e0c1c414a"),n("40f52d283acb8661d97f"),n("1a8a0d02691ba2237e1c");var sr=n("c4f39450f01ceef3e1a4");n("9c18a49d5131280d62e2"),n("df7d0ca888dfc4ab84c0"),n("c75488ff72785c93e091"),n("9522c301b87f3097acdb"),n("c051faebbdca1b75abc0"),n("e7db2ab4d56937661155"),n("6350ba3c445cdf809f5d"),n("6d75da2315198816512d"),n("2e326f71ba041e9e5483"),n("92d8b6d49c08574abb86"),n("32ed649d5a98409f05d0"),n("593fb6ed96492637817d"),n("0c83eda191a155223e4f"),n("70ed4cbab24ae23bde7d"),n("38209c7bc1e9aed95306"),n("9132142da73ea939e5d6"),n("ba53a5f89c617e663ad1"),n("8835a003a3ed67b22811"),n("8c6d270aa08c18b72e43"),n("0a240ff6093590e2060b"),n("61d2dc633a96c99ada22"),n("ed842d3aa93065270196"),n("4b78455cac8a29b25e34"),n("7e08bdc8c06aba9df8ea"),n("58a6adeccb3334926a24"),n("cf137f88cec7945b84a3"),n("d3c16768a7bfb407293b"),n("ec2bbc87777bad684f91");sr.registerTheme("default",Ct.o);var ur=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=[U,Object(l.routerMiddleware)(t)],r=f.compose,a=Object(f.createStore)(N(),Object(h.fromJS)(e),r(f.applyMiddleware.apply(void 0,n)));return a.runSaga=U.run,a.injectedReducers={},a.injectedSagas={},a}({},c.d),dr=document.getElementById("app"),fr=Object(l.syncHistoryWithStore)(c.d,ur,{selectLocationState:Object(x.b)()}),pr={path:"/",component:T,childRoutes:[{path:"/share/dashboard",component:In},{path:"/share/display",component:ir},{path:"*",name:"notfound",getComponent:function(e,t){n.e(6).then(n.bind(null,"8937ca26cad1b574ef33")).then(lr(t)).catch(cr)}}],indexRoute:{onEnter:function(e,t){t("/share")}}},br=function(e){o.render(r.createElement(i.Provider,{store:ur},r.createElement(P.a,{messages:e},r.createElement(c.b,{history:fr,routes:pr,render:Object(c.c)(Object(s.useScroll)())}))),dr)};window.Intl?br(W.b):new Promise(function(e){e(Promise.all([n.e(0),n.e(7)]).then(n.t.bind(null,"97694e21b72f8e9351c4",7)))}).then(function(){return Promise.all([n.e(0).then(n.t.bind(null,"f030ad8f70186ef5cb63",7))])}).then(function(){return br(W.b)}).catch(function(e){throw e}),window.__REACT_DEVTOOLS_GLOBAL_HOOK__&&(window.__REACT_DEVTOOLS_GLOBAL_HOOK__.inject=function(){})}},[[2,10,0,5]]]);